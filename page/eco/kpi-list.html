<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta19
* @link https://tabler.io
* Copyright 2018-2023 The Tabler Authors
* Copyright 2018-2023 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>业绩管理</title>
    <!-- CSS files -->
    <script src="../../static/js/tabler.min.js"></script>
    <link rel="stylesheet" href="../../static/css/tabler.min.css">
    <link rel="stylesheet" href="../../static/css/base.css">
    <link rel="stylesheet" href="../../static/css/tabler-vendors.min.css">
    <link rel="icon" href="../../static/img/favicon.ico" type="image/x-icon" />
    <script src="../../static/js/jquery.min.js"></script>
    <script src="../../static/js/base.js?1"></script>
    <link type="text/css" rel="stylesheet" href="https://faithful.oss-cn-shanghai.aliyuncs.com/static/jdate/skin/jedate.css">
    <script type="text/javascript" src="https://faithful.oss-cn-shanghai.aliyuncs.com/static/jdate/src/jedate.js"></script>
    <script src="../../static/js/watermark.js"></script>
    <script src="../../static/js/pg/eco/kpim.js"></script>
    <script>
      function dark(){
        let body = document.getElementById('webBody')
        body.setAttribute("data-bs-theme","dark")
      }

      function light(){
        let body = document.getElementById('webBody')
        body.setAttribute("data-bs-theme","")
      }

    </script>

  </head>
  <body  id="webBody" class="layout-fluid">
    <div class="page">


      <!--      &lt;!&ndash; Sidebar &ndash;&gt;-->
      
      
      <aside class="navbar navbar-vertical navbar-expand-lg"    >
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-menu" aria-controls="sidebar-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <h1 class="navbar-brand navbar-brand-autodark">
            <a href="#" >
              <img src="http://admin.fsfhr.com/banner.svg" width="110" height="32" alt="faithful" class="navbar-brand-image">
            </a>
          </h1>

          <div class="collapse navbar-collapse"   id="sidebar-menu">
            <ul class="navbar-nav pt-lg-3" id="menu">

              </li>
            </ul>
          </div>
        </div>
      </aside>
































































































      <!-- navbar navbar-expand-md d-print-none d-none d-lg-flex -->
      <!-- navbar navbar-expand-md d-print-none -->
      <header class="navbar navbar-expand-md d-print-none d-none d-lg-flex fixed-top">
        <div class="container-xl">



          <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal p-0 pe-md-6">
          </h1>
          <div class="navbar-nav flex-row order-md-last">
            <div class="nav-item d-none d-md-flex me-3">
              <div class="btn-list">
                <div class="input-icon">
                    <span class="input-icon-addon">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path><path d="M21 21l-6 -6"></path></svg>
                    </span>
                  <input type="text" value="" class="form-control" id="indexsearch" placeholder="客户名/人选名/项目名" aria-label="Search in website" data-listener-added_8ff64168="true">
                </div>
                <a onclick="indexSearch()" class="btn btn-blue" target="_blank" rel="noreferrer">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path></svg>
                  查询
                </a>
              </div>
            </div>
            <div class="d-none d-md-flex">
              <a   onclick="dark()" class="nav-link px-0 hide-theme-dark" data-bs-toggle="tooltip" data-bs-placement="bottom" aria-label="Enable dark mode" data-bs-original-title="Enable dark mode">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path></svg>
              </a>
              <a onclick="light()" class="nav-link px-0 hide-theme-light" data-bs-toggle="tooltip" data-bs-placement="bottom" aria-label="Enable light mode" data-bs-original-title="Enable light mode">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"></path><path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path></svg>
              </a>
              <div class="nav-item dropdown d-none d-md-flex me-3">
                <a href="#" class="nav-link px-0" data-bs-toggle="dropdown" tabindex="-1" aria-label="Show notifications" onclick="usermessage()" data-bs-auto-close="outside">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6"></path><path d="M9 17v1a3 3 0 0 0 6 0v-1"></path></svg>
                  <span class="badge bg-red"></span>
                </a>
                <div class="dropdown-menu dropdown-menu-arrow dropdown-menu-end dropdown-menu-card">
                  <div class="card">
                    <div class="card-header">
                      <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                          <a href="#" class="nav-link active" data-bs-toggle="tab" aria-selected="true" role="tab" onclick="usermessage()">信箱</a>
                        </li>
                        <li class="nav-item" role="presentation">
                          <a href="#" class="nav-link" data-bs-toggle="tab" aria-selected="false" tabindex="-1" role="tab" onclick="usertrip()">行程</a>
                        </li>
                      </ul>
                    </div>
                    <div class="list-group list-group-flush list-group-hoverable">
                      <div id="messagediv">
                        <div class="list-group-item divide-y"  id="msgstr"  >
                          <h3></h3>
                        </div>
                      </div>                      
                      <div id="tripdiv">
                        <div class="list-group-item divide-y" id="tripstr">
                          <h3></h3>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="nav-item dropdown">
              <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown" aria-label="Open user menu">
                <div class="d-none d-xl-block ps-2">
                  <div id="userName">无</div>
                  <div class="mt-1 small text-muted" id="userLevel">无</div>
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <a href="#" class="dropdown-item">个人中心</a>
                <a href="../employ/password-manager.html" class="dropdown-item">修改密码</a>
                <div class="dropdown-divider"></div>
                <a id="logOut" class="dropdown-item">退出</a>
              </div>
            </div>
          </div>
        </div>
      </header>



      <div class="page-wrapper">

        <div id="messageContainer" class="message-container">
          <!-- Messages will be added here dynamically -->
        </div>
  

        <!-- Page header -->
        <div class="page-header d-print-none">
        </div>




        <!-- Page body -->
        <div class="page-body container-xl">





          <div class="container-xl" >


            <div class="row row-deck row-cards">



              <div class="col-lg-12">
                <div class="card">
                
                  <div class="card-body" id="formdata">
                    <form id="myForm">
                      <div class="row col-lg-12"> 
                        <div class="col-lg-2  row" >
                          <label class="form-label wordbold col-4" >服务顾问</label>
                          <div class="col"  >
                             <input type="text" title="服务顾问" class="form-control" name="appUserName"   >
                          </div>
                        </div>

                        <div class="col-lg-2  row" >
                          <label class="form-label wordbold col-4" >服务客户</label>
                          <div class="col"  >
                             <input type="text" title="服务客户" class="form-control" name="customerName"  >
                          </div>
                        </div>
     

                        <div class="col-lg-2 row">
                          <label class="form-label wordbold col-4" >业绩来源</label>
                          <div class="col" >
                          <select class="form-select" id="payType"  name="payType">
                            <option selected value="">全部</option>
                            <option value="2">首付款</option>
                            <option value="0">服务费</option>
                            <option value="1">咨询费</option>
                          </select>
                          </div>
                        </div>
                       
                 

                        <div class="col-lg-4  mb-3 row" >
                          <label class="form-label wordbold col-2" >申请时间</label>
                          <div class="col"  >
                              <div class="jeinpbox"><input type="text" class="form-control" name="sqsj1" id="ymd01" placeholder="YYYY-MM-DD"></div>
                          </div>
                          <div class="col"  >
                            <div class="jeinpbox"><input type="text" class="form-control" name="sqsj2" id="ymd02" placeholder="YYYY-MM-DD"></div>
                          </div>
                        </div>
                          
                        <div class="col-lg-4  mb-3 row" >
                          <label class="form-label wordbold col-2" >审核时间</label>
                          <div class="col"  >
                              <div class="jeinpbox"><input type="text" class="form-control" name="shsj1" id="ymd03" placeholder="YYYY-MM-DD"></div>
                          </div>
                          <div class="col"  >
                            <div class="jeinpbox"><input type="text" class="form-control" name="shsj2" id="ymd04" placeholder="YYYY-MM-DD"></div>
                          </div>
                        </div>





                        <div class="col-lg-4 ms-auto">
                          <div class="col">
                           <a onclick="clearForm()" class="btn btn-link ms-auto ">清空 </a>
                           <a onclick="searchList()" class="btn btn-primary ms-auto ">查询</a>
                           <a  class="btn btn-success ms-auto" data-bs-toggle="modal" data-bs-target="#addtrip" >新增</a>

                          </div>
                    
                        </div>

                      </div>
                     

                    </form>
                    
  
                


                  </div>
      
      
      
      
                 













                  
      
                </div>
              </div>












              <div class="col-lg-12">
                <div class="card">
                  <div class="card-body">

                    <div class="table-responsive" id="table-default">
                      <table class="table card-table table-vcenter text-nowrap datatable">
                        <thead>
                          <tr>
                            <th>归属公司</th>
                            <th>服务顾问</th>
                            <th>客户名称</th>
                            <th>回款金额</th>
                            <th>上岗人选</th>
                            <th>提成金额/比例</th>
                            <th>业绩来源</th>
                            <th>审核状态</th>
                            <th>申请用户</th>
                            <th>申请日期</th>
                            <th>操作</th>
                          </tr>
                        </thead>
                        <tbody class="table-tbody" id="data">
                        
                        </tbody>
                      </table>
                    </div>
                    <div class="card-footer d-flex align-items-center">
                      <p class="m-0 text-muted">共<span id="totalPageNum">0</span>条 &nbsp;<span id="totalPageNum1"></span>页</p>
                      <ul class="pagination m-0 ms-auto" id="pageSelect">
                        
                      </ul>
                    </div>

                  </div>
                </div>
              </div>




            </div>











            <div class="modal modal-blur fade" id="addtrip" tabindex="-1" role="dialog" aria-hidden="true">
              <div class="modal-dialog modal-full-width modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">新增业绩</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">


                    <div class="row row-cards">

                      <div class="col-lg-6" >
                        <div class="card col-lg-12">
                          <div class="card-body row">
                            <div class="col-lg-6 mb-3" >
                              <label class="form-label wordbold col-3 required " >回款企业</label>
                              <div class="col"  >
                                <select type="text" class="form-select" placeholder="查询客户" id="appCustomer" autocomplete="off" name="customerId">
                                </select>
                                <div class="invalid-feedback">不能为空！</div>
                              </div>
                            </div>

                            <div class="col-lg-3 " >
                              <label class="form-label wordbold col-4 required " >回款金额</label>
                              <div class="col"  >
                                <input type="text" class="form-control" name="serviceFee" id="hkfee" readonly>
                              </div>
                            </div>
                            <div class="col-lg-3  " >
                              <label class="form-label wordbold col-4 required " >归属公司</label>
                              <div class="col"  >
                                <input type="text" class="form-control" name="comName"  id="comName"readonly  >
                              </div>
                            </div>
 
                            <div class="col-lg-3 " >
                              <label class="form-label wordbold col-4 required " >回款类型</label>
                              <div class="col"  >
                                <select class="form-select" id="tcfl"  name="tcfl">
                                  <option selected value="3">全额付款提成</option>
                                  <option value="4">分期付款提成</option>
                                </select>
                              </div>
                            </div>
                            <div class="col-lg-3 mb-3 " >
                              <label class="form-label wordbold col-4 required " >提成比例</label>
                              <div class="col"  >
                                 <div class="input-group input-group-flat">
                              <input type="number" class="form-control" autocomplete="off" id="tcbl" value="15">
                              <span class="input-group-text">
                                <kbd>%</kbd>
                              </span>
                            </div>
                              </div>
                            </div>

                            <hr>

                            <div class="col-lg-3 mb-3 row" >
                              <label class="form-label wordbold col-6 required " >可分配金额</label>
                              <div class="col"  >
                                <span id="allotFee">0</span>
                              </div>
                              
                            </div>

                      
                            <div class="col-lg-4 mb-3 row" >
                              <label class="form-label wordbold required col-4" >分配金额</label>
                              <div class="col"  >
                                <input type="number" class="form-control" name="commissionFee" id = 'realAllotFee' >
                              </div>
                              <small class="form-hint">默认0时，点击分配则为全部可分配金额</small>
                            </div>
                   
                      
                            <div class="col-lg-4  row" >
                              <div class="col">
                                
                                <a class="btn btn-blue btn-sm" onclick="initWay()">新增分配</a>
                                <!-- <a class="btn btn-danger btn-sm">清空</a> -->
                                <a class="btn btn-blue btn-sm" onclick="confirmAllot()">确认分配</a>
                              </div>
                            </div>
                            <hr>

                            <div class="row" > 
                              <div class="col-lg-3 mb-3 row" >
                                <label class="form-label wordbold required col-6" >当前分配额</label>
                                <div class="col"  >
                                  <span style="color:red" id="nowAllotFee">0</span>
                                </div>
                                
                            </div>
                            <div class="col-lg-4 mb-3 row" >
                              <label class="form-label wordbold  col-4" >人选名称</label>
                              <div class="col"  >
                                <select name="talentId" class="form-select" id="talentInfo">
                                  
                                </select>
                              </div>
                            </div>

                            <div class="col-lg-4 mb-3 row" >
                              <label class="form-label wordbold  col-4" >分配方式</label>
                              <div class="col"  >
                                <select class="form-select" id="allotType"  name="type">
                                <option selected value="0">独立运作</option>
                                <option value="1">组内合作</option>
                                <option value="2">同城合作</option>
                                <option value="3">跨区合作</option>
                              </select>
                              </div>
                            </div>


                     
                
                      
                              <div class="row" id="fpjjejs" > 
                                <div class="col-lg-12 mb-3 row" >
                                  <table class="table card-table table-vcenter text-nowrap datatable">
                                    <thead>
                                                            
                                      <tr>
                                        <th class="col-1">所属类型</th>
                                        <th class="col-4">提成人</th>
                                        <th class="col-1">所在公司</th>
                                        <th class="col-2">业绩比例 <small>可分配：<span style="color: red;" id="remaining">0</span></small></th>
                                        <th class="col-2">业绩金额</th>
                                        <th class="col-2">提成金额</th>
                                      </tr>
                                    </thead>
                                    <tbody class="table-tbody" id="calcData">

                                      <tr>
                                        <td>客户线索</td>
                                        <td>
                                           <select type="text" class="form-select" placeholder="查询客户" id="employer1" autocomplete="off" name="appUserId">
                                          </select>
                                        </td>
                                        <td>暂无</td>
                                        <td>


                                            <div class="input-group input-group-flat">
                                              <input type="number"min="0" class="form-control" autocomplete="off" value="10">
                                              <span class="input-group-text">
                                                <kbd>%</kbd>
                                              </span>
                                            </div>

                                        </td>
                                        <td>0</td>
                                        <td>0</td>
                                      </tr>
                                      <tr>
                                        <td>签约谈判</td>
                                        <td>

                                          <select type="text" class="form-select" placeholder="查询客户" id="employer2" autocomplete="off" name="appUserId">
                                          </select>

                                        </td>
                                        <td>暂无</td>
                                              <td>


                                            <div class="input-group input-group-flat">
                                              <input type="number" min="0" class="form-control" autocomplete="off" value="10">
                                              <span class="input-group-text">
                                                <kbd>%</kbd>
                                              </span>
                                            </div>

                                        </td>
                                        <td>0</td>
                                        <td>0</td>
                                      </tr>
                                      <tr>
                                        <td>人选线索</td>
                                        <td>

                                          <select type="text" class="form-select" placeholder="查询客户" id="employer3" autocomplete="off" name="appUserId">
                                          </select>

                                        </td>
                                        <td>暂无</td>
                                              <td>


                                            <div class="input-group input-group-flat">
                                              <input type="number" min="0" class="form-control" autocomplete="off" value="30">
                                              <span class="input-group-text">
                                                <kbd>%</kbd>
                                              </span>
                                            </div>

                                        </td>
                                        <td>0</td>
                                        <td>0</td>
                                      </tr>
                                      <tr>
                                        <td>人选推荐</td>
                                        <td>

                                          <select type="text" class="form-select" placeholder="查询客户" id="employer4" autocomplete="off" name="appUserId">
                                          </select>

                                        </td>
                                        <td>暂无</td>
                                              <td>


                                            <div class="input-group input-group-flat">
                                              <input type="number" min="0" class="form-control" autocomplete="off" value="30">
                                              <span class="input-group-text">
                                                <kbd>%</kbd>
                                              </span>
                                            </div>

                                        </td>
                                        <td>0</td>
                                        <td>0</td>
                                      </tr>
                                      <tr>
                                        <td>职位运作</td>
                                        <td>

                                          <select type="text" class="form-select" placeholder="查询客户" id="employer5" autocomplete="off" name="appUserId">
                                          </select>

                                        </td>
                                        <td>暂无</td>
                                              <td>


                                            <div class="input-group input-group-flat">
                                              <input type="number"  min="0" class="form-control" autocomplete="off" value="10">
                                              <span class="input-group-text">
                                                <kbd>%</kbd>
                                              </span>
                                            </div>

                                        </td>
                                        <td>0</td>
                                        <td>0</td>
                                      </tr>
                                      <tr>
                                        <td>款项回收</td>
                                        <td>
                                          <select type="text" class="form-select" placeholder="查询客户" id="employer6" autocomplete="off" name="appUserId">
                                          </select>
                                        </td>
                                        <td>暂无</td>
                                              <td>


                                            <div class="input-group input-group-flat">
                                              <input type="number" min="0" class="form-control" autocomplete="off" value="10">
                                              <span class="input-group-text">
                                                <kbd>%</kbd>
                                              </span>
                                            </div>

                                        </td>
                                        <td>0</td>
                                        <td>0</td>
                                      </tr>




                                    
                                    </tbody>
                                  </table>
                                  <div id="totalstr" style="color: red;">

                                  </div>
                                </div>
                              </div>


                          </div>
                        
                        </div>


                     



                       
                            


                      </div>
                      <!-- 111-->








































                      
                      








                      


                    </div>


                    <div class="col-lg-6" >
                        <div class="card col-lg-12">
                          <div class="card-body row" id="displayData"></div>
                          <div class="card-footer">
                            <span style="color: red;" id = 'totalALL'> 

                            </span>
                          
                            <div class="col-lg-4 ms-auto">
                                <a class="btn btn-primary" onclick="addKPi()" >
                                                      录入业绩    
                                                    </a>
                            </div>
                          
                          </div>       
                        </div>
                    </div>  
                  <div class="modal-footer">
                    <a class="btn btn-primary" onclick="addKPi()" >
                      录入业绩    
                    </a>
                  </div>
                </div>
              </div>
            </div>




            
              </div>
            </div>


        


              <div class="modal modal-blur fade" id="showdetail" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">业绩详情</h5>
                    </div>       
                    <div class="modal-body text-center py-4" id="showdetailbody">
                      
                    </div>
                  </div>
                </div>
              </div>





        <script>
          let tomins =[];
          let customerMember;
          let allotFeeSpan,realAllotFeeInput,allocatedAmount   = 0;
          const inputs = document.querySelectorAll('#calcData input[type="number"]');
      document.addEventListener('DOMContentLoaded', function() {
           

        // 初始化所有输入框
        inputs.forEach(input => {
            input.addEventListener('input', updateCalculations);
            input.addEventListener('blur', enforceLimits);
        });

         
          customerMember= new TomSelect('#appCustomer',{
              valueField: 'sfId',
              labelField: ['customerName', 'fee'],
              searchField: 'customerName',
              // fetch remote data
              load: function(query, callback) {

                  const options = {
                      method: 'POST',
                      headers: {
                      'Content-Type': 'application/json',
                      'token':localStorage.getItem('token')
                      },
                      body: JSON.stringify({ 'customerName': query }),
                      };

                      var url = baseUri+'/eco/selectMyServiceFeeList';
                  fetch(url,options)
                      .then(response => response.json())
                      .then(json => {
                        var item = json.data.list;
                        
              
                          callback(item);
                      }).catch((error)=>{
                          callback();
                      });

              },
              // custom rendering functions for options and items
              render: {
                  option: function(item, escape) {

                   
              return `<div><span class="dropdown-item-indicator"  >
              </span>${ escape(item.customerName) } / ${escape(item.fee)}</div>`;
          
                      
                  },
                  item: function(item, escape) {
                   
              return `<div><span class="dropdown-item-indicator"  >
              </span>${ escape(item.customerName) } / ${escape(item.fee)}</div>`;
          
                  }
              },
              onInitialize: function() {
                  this.clearOptions(); // 清空初始选项
                  this.load(''); // 传入空字符串以加载所有选项或基于默认查询
              },
          });

          customerMember.on('change', function(value) {
   
            // 在这里执行你的逻辑

             allotFeeSpan = customerMember.options[value].fee || 0;
            
            $('#realAllotFee').val(0);
            $('#allotFee').text( customerMember.options[value].fee || 0);
            $('#comName').val(customerMember.options[value].comName || '');
            $('#hkfee').val(customerMember.options[value].fee || 0);

            let tpList= customerMember.options[value].tpList || [];
            if(tpList.length>0){
              let tpListHtml = '';
              tpList.forEach((item,index)=>{
                if(index==0){
                  tpListHtml += `<option selected value="${item.tpId}">${item.talentName}</option>`; 
                }else{
                tpListHtml += `<option value="${item.tpId}">${item.talentName}</option>`;

                }
              }); 
              $('#talentInfo').html(tpListHtml); 
            }




        
          });


          document.getElementById('realAllotFee').addEventListener('input', function() {
            const inputValue = parseFloat(this.value) || 0;
            const isValid = validateInput(this.value);

            if (isValid) {
                    $('#allotFee').text((allotFeeSpan - inputValue).toFixed(3));
                } else {
                    // 如果超过可分配金额，则修正输入值
                    if (inputValue > allotFeeSpan) {
                        this.value = allotFeeSpan;
                        $('#allotFee').text(0.00);
                    }
                }
          });


           


          document.querySelectorAll('[name="appUserId"]').forEach(function(item) {

            new TomSelect(item,{
              valueField: 'userId',
              labelField: 'name',
              searchField: 'name',
              // fetch remote data
              load: function(query, callback) {

                  const options = {
                      method: 'POST',
                      headers: {
                      'Content-Type': 'application/json',
                      'token':localStorage.getItem('token')
                      },
                      body: JSON.stringify({ 'name': query }),
                      };

                      var url = baseUri+'/customer/ulfq';
                  fetch(url,options)
                      .then(response => response.json())
                      .then(json => {
                        var item = json.data.list;
              
                          callback(item);
                      }).catch((error)=>{
                          callback();
                      });

              },
              // custom rendering functions for options and items
              render: {
                  option: function(item, escape) {
              return `<div><span class="dropdown-item-indicator"  >
              </span>${ escape(item.name)  }</div>`;
          
                      
                  },
                  item: function(item, escape) {
              return `<div><span class="dropdown-item-indicator"  >
              </span>${ escape(item.name) }</div>`;
          
                  }
              },
             
          });
          });


          













        });

        function validateInput(value) {
                const numValue = parseFloat(value) || 0;
                
                if (numValue > allotFeeSpan) {
                  
                    return false;
                } else if (numValue < 0) {
                    
                    return false;
                } else {
                  
                    return true;
                }
            }



        </script>


       










        <script src="../../static/js/list.min.js" defer></script>
        <script src="../../static/js/tom-select.base.min.js" ></script>

   


       
        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="row text-center align-items-center flex-row-reverse">
              <div class="col-12">
              <!-- <div class="col-12 col-lg-auto mt-3 mt-lg-0 text-center "> -->
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">
                    Copyright &copy; 2021  

                    <a href="#" class="link-secondary"> 费思福(成都)人力资源咨询有限公司 </a>
                  
                  </li>
                  <li class="list-inline-item">
                    蜀ICP备2021005893号-2
             
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    
  </body>
</html>